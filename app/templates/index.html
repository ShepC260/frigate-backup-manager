{% extends "base.html" %}

{% block content %}
  <div class="layout">
    <!-- Main backups card -->
    <div class="card">
      <div class="card-header">
        <h2>Backups</h2>
        <div class="gdrive-header">
          <img
            src="https://www.gstatic.com/images/branding/product/1x/drive_2020q4_48dp.png"
            alt="Google Drive"
          />
          <label class="switch">
            <input type="checkbox" id="gdriveToggle" onchange="toggleDriveEnabled()" />
            <span class="slider"></span>
          </label>
          <button class="secondary" onclick="openDriveModal()">Configure</button>
        </div>
      </div>

      <div>
        <button onclick="runBackup()">Run Backup Now</button>
        <button class="secondary" onclick="loadBackups()">Refresh</button>
      </div>
      <div id="backupStatus" class="status"></div>
      <div id="backupList" class="backup-list">
        <div style="padding: 0.7rem;">Loading backups...</div>
      </div>
    </div>

    <!-- System card -->
    <div class="card">
      <h2>System</h2>
      <div class="system-list" id="systemStatusContainer">
        <!-- filled by JS -->
      </div>
      <div class="status" id="statusTime"></div>

      <div class="system-actions">
        <button onclick="runSystemAction('update_os')">Full OS Update</button>
        <button onclick="runSystemAction('restart_frigate')">Restart Frigate</button>
        <button class="secondary" onclick="runSystemAction('reboot')">Reboot System</button>
      </div>

      <div style="margin-top:0.7rem;">
        <button class="secondary" onclick="openHostnameModal()">Set Hostname</button>
        <button class="secondary" onclick="openUpdateModal()">Update Details</button>
        <button class="secondary" onclick="manualUpdateCheck()">Check for Updates Now</button>
      </div>
    </div>
  </div>

  <!-- Last Command Output Panel -->
  <div class="last-output-wrapper">
    <div class="last-output-header" onclick="toggleLastOutput()">
      <span>Last Command Output</span>
      <span class="last-output-toggle" id="lastOutputToggle">â–¼</span>
    </div>
    <div class="last-output-body" id="lastOutputBody">
      <pre id="lastOutputContent">No commands run yet.</pre>
    </div>
  </div>

  <div class="footer-links">
    ðŸ“„ <a href="/logs" target="_blank">View full logs</a>
  </div>

  {% include "modals/restore.html" %}
  {% include "modals/hostname.html" %}
  {% include "modals/update.html" %}
  {% include "modals/drive.html" %}
{% endblock %}

{% block scripts %}
  <script src="/static/js/main.js"></script>
  <script src="/static/js/modals.js"></script>
  <script src="/static/js/drive.js"></script>
{% endblock %}
